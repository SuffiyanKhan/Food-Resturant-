<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" /> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"> 
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css -->
    ">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Document</title>
    <link rel="stylesheet" href="practice.css">
    <link rel="stylesheet" href="responsive.css">
    <style>
        .menuCards .sf{
            justify-content: space-between;
            align-items: center;
            font-size: 25px;
        }
        .menuCards .sf i{
            display: flex;
            justify-content: center;
            align-items: center;
            width: 45px;
            height: 43px;
            border-radius: 50px;
            /* border: 2px solid; */
            cursor: pointer;
        }
        .menuCards .sf i:hover,
        .menuCards .sf i:active{
            background-color: rgb(210, 197, 197);
        }
    </style>
    
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navigation-wrap scroll-on">
            <div class="container">
                <a class="navbar-brand" href="#"><img src="images/logo/logo.png" alt=""></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation"><i class="fas fa-stream navbar-toggler-icon"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarText">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link " id="showPopups" href="#">Upload Category</a>
                        </li>
                        
                        <input type="checkbox" id="check">
                        <label for="check">
                                <a class="nav-link" id="cartBtn">
                                    <p id="cartNo"></p>
                                <i class="fas fa-bars main-btn" style="color: white;" id="btn"> Card </i>
                                </a>
                        </label>
                        <div class="sidebar">
                            <div class="hearder">
                                <header>My Card</header>
                                <div class="closeBar">
                                    <input type="checkbox" name="" id="check">
                                    <label for="check">
                                        <i class="fas fa-times" id="canceel"></i>
                                    </label>
                                </div>
                            </div>
                            <hr>
                            <div class="offcanvas-body">
                                <ul class="cartList">
                                </ul>                             
                                <hr>
                                <div class="cartPriceDiv">
                                    <h6>Total Price</h6>
                                    <p class="cartTotalPricePara"></p>
                                </div>
                                <hr>
                            </div>
                        </div>                    
                    </ul>
                </div>
            </div>
        </nav>
    </header>
   <!-- =================================================================== -->
    <section id="menuCards">
        <div class="menuCards">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12 cards">
                        <h2>Chicken</h2>
                    </div>
                </div>
                <div class="row showCategorys">
                    <!-- <div class="card col-lg-4 col-md-6 mb-lg-0 mb-4" >
                        <img src="images/chicken/5f6fg0l8_keraal-roast-chicken_625x300_14_December_19.webp" class="card-img-top" alt="...">
                        <div class="card-body">
                            <div class="d-flex sf">
                                <h2 class="card-title">Keraal-rost chicken</h2>
                                <i class="fa-solid fa-ellipsis-vertical deleteCate"></i>
                            </div>
                         <p>Time: 15 - 20 Minutes | Serves: 1</p>
                         <span>$10.50 <del>$11.70</del></span>
                          <button class="main-btn mt-4">Order Now</button>
                        </div>
                    </div>
                    <div class="card col-lg-4 col-md-6 mb-lg-0 mb-4" >
                        <img src="images/chicken/chicken=shawarma.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                            <div class="d-flex sf">
                                <h2 class="card-title">Chicken shawarma</h2>
                                <i class="fa-solid fa-ellipsis-vertical"></i>
                            </div>
                         <p>Time: 15 - 20 Minutes | Serves: 1</p>
                                <span>$9.50 <del>$11.70</del></span>
                          <button class="main-btn mt-4">Order Now</button>
                        </div>
                    </div> -->
                    <!-- <div class="card col-lg-4 col-md-6 mb-lg-0 mb-4" >
                        <img src="images/chicken/download (3).jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                          <h2 class="card-title">Chicken Tikka</h2>
                          <p>Time: 15 - 20 Minutes | Serves: 1</p>
                          <span>$10.50 <del>$11.70</del></span>                            <button class="main-btn mt-4">Order Now</button>
                        </div>
                    </div> -->
                    <!-- <div class="card col-lg-4 col-md-6 mb-lg-0 mb-4" >
                        <img src="images/chicken/download (2).jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                          <h2 class="card-title">Chicken Karrai</h2>
                           <p>Time: 15 - 20 Minutes | Serves: 1</p>
                                <span>$10.50 <del>$11.70</del></span>
                            <button class="main-btn mt-4">Order Now</button>
                        </div>
                    </div> -->
                    <!-- <div class="card col-lg-4 col-md-6 mb-lg-0 mb-4" >
                        <img src="images/chicken/download.jpg" class="card-img-top" alt="...">
                        <div class="card-body">
                          <h2 class="card-title">Chicken Biryani</h2>
                           <p>Time: 15 - 20 Minutes | Serves: 1</p>
                                <span>$10.50 <del>$11.70</del></span>
                            <button class="main-btn mt-4">Order Now</button>
                        </div>
                    </div> -->
                </div>
            </div>
        </div>
    </section>
    <!-- ============ Add Categorys ============ -->
    <div class="profilePopup1">
        <div class="container">
            <div class="row">
                <div class="text-center mt-4">
                    <h2 id="getdet">Add Category</h2>
                </div>
                <div class="d-flex col-lg-6 col-12 col-md-6 mt-4">
                    <input placeholder="Enter Category Name" required class="form-control" style="width: 300px;" type="text" id="getCategoryName">
                </div>
                <div class="d-flex col-lg-6 col-12 col-md-6 mt-4">
                    <input placeholder="Enter Price" required class="form-control" style="width: 300px;" type="text" id="getCategoryPrice">
                </div>
                <div class="d-flex col-lg-6 col-12 col-md-6 mt-4">
                    <input placeholder="Enter Time duration" required class="form-control" style="width: 300px;" type="text" id="getCategoryTimeDuration">
                </div>
                <div class="mt-3 d-flex popup">
                    <div class="clpop mt-3">
                        <input type="file" id="getfile">
                        <label for="" id="hidden"></label>
                        <label for="getfile" id="show"> Add category image</label>
                    </div>
                </div>
                <div class=" bbbttn mt-4">
                    <button  class="btn btn-dark" id="addC">Add category</button>
                </div>
            </div>
        </div>
    </div>    
    <!-- =========================== java script =========================== -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
import { storage } from "./config.js";
import {collection, addDoc, getDocs,onSnapshot,deleteDoc,doc} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import{db} from "./config.js"

        let getfile = document.querySelector('#getfile');
        let addC = document.querySelector('#addC');
        let getCategoryName = document.querySelector('#getCategoryName');
        let getCategoryPrice= document.querySelector('#getCategoryPrice');
        let getCategoryTimeDuration = document.querySelector('#getCategoryTimeDuration');
        let userIDS = localStorage.getItem('userIDS');
        let showCategorys = document.querySelector('.showCategorys')
        let downloadUR ;
        let uploaded_image ="";
// ========================== Add Categorys ========================== //

        addC.addEventListener('click', async()=>{
            try {
  const docRef = await addDoc(collection(db, userIDS), {
    Categorys_Image: downloadUR,
    Category_Name : getCategoryName.value,
    Category_Price : getCategoryPrice.value,
    Category_TimeDuration: getCategoryTimeDuration.value,
    

  });

  console.log("Document written with ID: ", docRef.id);
} catch (e) {
//   console.error("Error adding document: ", e);
}
document.querySelector('.profilePopup1').style.zIndex=-1;
document.querySelector('.profilePopup1').style.opacity=0;
document.querySelector('.profilePopup1').style.display='none'
            // try {
            //     const docRef = await addDoc(collection(db, userIDS), {
            //         Category_Name : getCategoryName.value,
            //         Category_Price : getCategoryPrice.value,
            //         Category_TimeDuration :  getCategoryTimeDuration.value,
            //         Category_Image : downloadUR,
            //         // time : new Date().toLocaleString()
            //     })
            //     location.reload()
            //     console.log(getCategoryName.value)
            // }catch (e) {
            //   // console.error("Error adding document: ", e);
            // }   
        })


        onSnapshot((collection(db, userIDS)), (data) => {
            data.docChanges().forEach((element) => {
                if(element.type == "removed"){
                    let deletCategorys = document.querySelector('#element.doc.id');
                    if(deletCategorys){
                        deletCategorys.remove()
                    }
                }else if(element.type === "added"){
                    let CategorysName = element.doc.data().Category_Name;
                    let CategoryPrice = element.doc.data().Category_Price;
                    let CategoryId = element.doc.id;
                    let CategoryImage = element.doc.data().Category_Image;
                    let CategoryTimeDuration = element.doc.data().Category_TimeDuration
                    displayCards(CategorysName , CategoryPrice , CategoryId ,CategoryImage , CategoryTimeDuration);
                    // showCategorys.innerHTML +=`
                    // <div class="card col-lg-4 col-md-6 mb-lg-0 mb-4" id="${CategoryId}">
                    //     <div class="card-body">
                    //         <div class="d-flex sf">
                    //             <h2 class="card-title">${CategorysName}</h2>
                    //             <i class="fa-solid fa-ellipsis-vertical
                    //             deleteCate" onclick="deleteCate('${CategoryId}')"></i>
                    //         </div>
                    //        <p>Time: ${CategoryTimeDuration} Minutes | Serves: 1</p>
                    //             <span>Price :$${CategoryPrice}</span>
                    //         <button onclick="addToChart('${CategoryId}' , '${CategorysName}' , '${CategoryPrice}' ,'${CategoryImage}' , '${CategoryTimeDuration}')" class="main-btn mt-4">Order Now</button>
                    //     </div>
                    // </div>
                    // `
                    // showCategorys.innerHTML +=`
                    // <div class="card col-lg-4 col-md-6 mb-lg-0 mb-4" id="${element.doc.id}">
                    //     <div class="card-body">
                    //       <h2 class="card-title">${element.doc.data().Category_Name}</h2>
                    //        <p>Time: ${element.doc.data().Category_TimeDuration} Minutes | Serves: 1</p>
                    //             <span>${element.doc.data().Category_Price}</span>
                    //         <button class="main-btn mt-4">Order Now</button>
                    //     </div>
                    // </div>
                    // `
                    // <img src="${element.doc.data().Category_Image}" class="card-img-top" alt="...">
                    

                    // console.log(element.doc.data().Category_Image)
                }
            });
        })
        // <div class="d-flex sf">
        //                         <h2 class="card-title">Chicken shawarma</h2>
        //                         <i class="fa-solid fa-ellipsis-vertical"></i>
        //                     </div>

        let displayCards=(CategorysName , CategoryPrice , CategoryId ,CategoryImage , CategoryTimeDuration)=>{
            showCategorys.innerHTML +=`
                    <div class="card col-lg-4 col-md-6 mb-lg-0 mb-4" id="${CategoryId}">
                        <div class="card-body">
                            <div class="d-flex sf">
                                <h2 class="card-title">${CategorysName}</h2>
                                <i class="fa-solid fa-ellipsis-vertical
                                deleteCate" onclick="deleteCate('${CategoryId}')"></i>
                            </div>
                           <p>Time: ${CategoryTimeDuration} Minutes | Serves: 1</p>
                                <span>Price :$${CategoryPrice}</span>
                            <button onclick="addToChart('${CategoryId}' , '${CategorysName}' , '${CategoryPrice}' ,'${CategoryImage}' , '${CategoryTimeDuration}')" class="main-btn mt-4">Order Now</button>
                        </div>
                    </div>
                    `
//   <img src="${CategoryImage}" class="card-img-top" alt="...">

            console.log(CategoryId)
        }
        let uniqueId = localStorage.getItem("uniqueId");
        function generateRandomId() {
    // Get the current timestamp
    const timestamp = new Date().getTime();

    // Generate a random number (use Math.random() or a more advanced random function)
    const randomNumber = Math.floor(Math.random() * 1000);

    // Concatenate timestamp and random number to create the ID
    const randomId = `${timestamp}${randomNumber}`;

    return randomId;
}


        if (!uniqueId) {
    uniqueId = generateRandomId();
    localStorage.setItem("uniqueId", uniqueId);
}
let cartNoPara = document.querySelector('#cartNo')
let cartQuant;
const getCarts = () => {
    onSnapshot(collection(db, uniqueId), (data) => {
        cartQuant = data.size;
        console.log(data.size)
        if (cartQuant) {
            btn.disabled = false
            cartNoPara.style.display = "flex";
            cartNoPara.innerHTML = `${cartQuant}`
        } else {
            cartNoPara.style.display = "none";
        }
    })
}
getCarts();

async function addToChart(CategoryId, CategorysName, CategoryPrice, CategoryImage) {
    try {
        let singleProduct = {
            Categoryid : CategoryId,
            Categorysname : CategorysName,
            Categoryprice : CategoryPrice,
            Categoryimage : CategoryImage
        }
        const docRef = await addDoc(collection(db, uniqueId), {
            ...singleProduct,
            time: new Date().toLocaleString()
        });
    } catch (e) {
        console.error("Error adding document: ", e);
    }
}

let cartList = document.querySelector('.cartList');
let cartBtn = document.querySelector('#cartBtn');
let cartTotalPricePara = document.querySelector('.cartTotalPricePara')
cartBtn.addEventListener("click", () => {

cartList.innerHTML = "";
let cartTotalPrice = 0;
let UpdPrice=0;

onSnapshot(collection(db, uniqueId), (data) => {
    cartQuant = data.size;
    console.log(cartQuant)
    if (cartQuant) {
        btn.disabled = false
        data .docChanges().forEach((singleCartProduct) => {
            let cartProductPrice = +singleCartProduct.doc.data().Categoryprice;
            if (singleCartProduct.type === "added") {
                console.log(singleCartProduct.doc.data().Categorysname)
                const cartProductId = singleCartProduct.doc.data().CategoryId;
                const cartProductImg = singleCartProduct.doc.data().CategoryImage;
                const cartProductTitle = singleCartProduct.doc.data().CategorysName;
                cartTotalPrice += cartProductPrice;
                console.log(cartTotalPrice)

                cartList.innerHTML += `
                <li class="cartProductList mt-3" id="${singleCartProduct.doc.id}">
                    <div class="cartProductDetailDiv">
                        <p><i class="fa-regular fa-circle" style="color: #4B1EB1;"></i></p>
                        <div class="cartProductImgDiv">
                            
                        </div>
                        <div class="cartProductTitle">
                            <p id="cartProductTitlePara">${singleCartProduct.doc.data().Categorysname}</p>
                        </div>
                    </div>
                    <div class="cartProductPrice">
                        <p id="cartProductPricePara">$${singleCartProduct.doc.data().Categoryprice}</p>
                        <p id="xMark" onclick="delCartProduct('${singleCartProduct.doc.id}')"><i class="fa-solid fa-xmark fa-lg" style="color: #f55555;"></i></p>
                    </div>
                </li>
                `

            } else if (singleCartProduct.type === "removed") {
                let delLi = document.getElementById(singleCartProduct.doc.id)
                if (delLi) {
                    delLi.remove()
                }
                cartTotalPrice -= cartProductPrice;
            }
            cartTotalPricePara.innerHTML = `$${cartTotalPrice}`
            // `$${cartTotalPrice}`
        })
    } else {
        // $('#addChartCanvas').offcanvas('hide');
        // btn.disabled = true;
    }
})

})
async function delCartProduct(id) {
    await deleteDoc(doc(db, uniqueId, id));
}
let deleteCate =async(id)=>{
    await deleteDoc(doc(db, userIDS, id));
    console.log(id)
}
window.deleteCate = deleteCate
window.addToChart = addToChart
window.delCartProduct = delCartProduct

//  ===============================================================  //
//  ===============================================================  //
//  ===============================================================  //


// document.querySelector('.deleteCate').addEventListener('click',()=>{
//     const swalWithBootstrapButtons = Swal.mixin({
//         customClass: {
//           confirmButton: 'btn btn-success',
//           cancelButton: 'btn btn-danger'
//         },
//         buttonsStyling: false
//       })
//       swalWithBootstrapButtons.fire({
//         title: 'Are you sure?',
//         icon: 'warning',
//         showCancelButton: true,
//         confirmButtonText: 'Delete Category!',
//         cancelButtonText: 'Cancel!',
//         reverseButtons: true
//       }).then((result) => {
//         if (result.isConfirmed) {
//           Swal.fire({
//             position: 'center',
//             icon: 'success',
//             title: 'Your Category has been Delete',
//             showConfirmButton: false,
//             timer: 3000
//           }).then( async() => {
//             if (true) {
//             }
//           });
//         }
//       })
// })




//  ===============================================================  //
//  ===============================================================  //
//  ===============================================================  //

//         onSnapshot((collection(db, userIDS)), (data) => {
//     data.docChanges().forEach((data) => {
//         if (data.type == "removed") {
//           let delLi = document.getElementById(data.doc.id);
//           if (delLi) {
//             delLi.remove()
//           }
//         } else if (data.type === "added") {
//     showCategorys.innerHTML += `
//     <div class="card col-lg-4 col-md-6 mb-lg-0 mb-4"  >
//     <div class="card-body">
//     <img src="${doc.data().Categorys_Image}" class="card-img-top" alt="...">

//         <h2 class="card-title">${doc.data().Category_Name}</h2>
//              <p>Time: ${doc.data().Category_TimeDuration} Minutes | Serves: 1</p>
//             <span>${doc.data().Category_Price}</span>
//         <button class="main-btn mt-4">Order Now</button>
//     </div>
// </div> `
//   console.log(`${doc.id} => ${doc.data()}`);
// }
//     })
// });

       
    //    console.log(userIDS)
//     let showCategory= async()=>{
//     const querySnapshot = await getDocs(collection(db, userIDS));
// querySnapshot.forEach((doc) => {
// //     showCategorys.innerHTML +=`
// //     <div class="card col-lg-4 col-md-6 mb-lg-0 mb-4"  >
// //     <img src="${doc.data().Categorys_Image}" class="card-img-top" alt="...">
// //     <div class="card-body">
// //         <h2 class="card-title">${doc.data().Category_Name}</h2>
// //              <p>Time: ${doc.data().Category_TimeDuration} Minutes | Serves: 1</p>
// //             <span>${doc.data().Category_Price}</span>
// //         <button class="main-btn mt-4">Order Now</button>
// //     </div>
// // </div> 
// //     `
//   console.log(`${doc.id} => ${doc.data()}`);
// });
//     }
//     showCategory()

// onSnapshot(query(collection(db, userIDS),orderBy("time")), (data) => {
//     data.docChanges().forEach((data) => {
//         if (data.type == "removed") {
//           let delLi = document.getElementById(data.doc.id);
//           if (delLi) {
//             delLi.remove()
//           }
//         } else if (data.type === "added") {
//     //         showCategory.innerHTML +=`
//     // <div class="card col-lg-4 col-md-6 mb-lg-0 mb-4" id="${data.doc.id}" >
//     //     <img id="showInnerCat" src="${data.doc.data().download_Url}" onclick="showInnerCategory('${data.doc.id}')" class="card-img-top">
//     //     <div class="card-body d-flex ssd">
//     //     <h2 class="card-title"> ${data.doc.data().getCategory}</h2>
//     //     <abbr title="Delete Category">
//     //     <i class="fa-solid fa-trash delete" onclick="delet('${data.doc.id}')"></i>
//     //     </abbr>
//     //     </div>
//     // </div>
//     // `
//     console.log("Current data: ", data.doc.id);
//         }
//     })
// });

    



// ========================== Send Categorys Images ========================== //
        getfile.addEventListener("change", function(){
            console.log(getfile.files[0].name)
    document.querySelector('#hidden').style.display ='flex'
    document.querySelector('#show').style.display='none';
    let getfiles = getfile.files[0].name
    const mountainImagesRef = ref(storage, `CategorysImages/${getfiles}`);
    const uploadTask = uploadBytesResumable(mountainImagesRef, getfile.files[0]);

uploadTask.on('state_changed', 
  (snapshot) => {
    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
    if(progress == 100){
        const reader = new FileReader();
  reader.addEventListener("load", () => {
    uploaded_image = reader.result;
    document.getElementById("hidden").style.backgroundImage = `url(${uploaded_image})`;
  });
  reader.readAsDataURL(this.files[0])
  document.getElementById('hidden').innerHTML="";
  addC.disabled = false
//   addC.style.display = 'block'
    }else{
        document.getElementById('hidden').innerHTML='Loading ....'
    }
    console.log('Upload is ' + progress + '% done');
    switch (snapshot.state) {
      case 'paused':
        console.log('Upload is paused');
        break;
      case 'running':
        addC.disabled = false
        console.log('Upload is running');
        break;
    }
  }, 
  (error) => {
    // Handle unsuccessful uploads
  }, 
  () => {
    getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
      console.log('File available at', downloadURL);
      downloadUR = downloadURL;
      addC.style.display = 'block'

    });
  }
);
})













       document.querySelector('#showPopups').addEventListener('click',()=>{
        document.querySelector('.profilePopup1').style.zIndex=1;
        document.querySelector('.profilePopup1').style.opacity=1;
        document.querySelector('.profilePopup1').style.display='block'
        console.log('hi')
       })




    </script>   
</body>
</html>